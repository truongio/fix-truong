<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Fix Truong</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Inter:wght@300;400;500;600;700;800;900&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      /* Base Palette - Mobile */
      --bg: #FAFAFA;
      --text: #0A0A0A;
      --text-dim: #525252;
      --text-muted: #A3A3A3;
      --accent: #0A0A0A;
      --accent-warm: #C2410C;
      --accent-orange: #C2410C;
      --success: #059669;
      --sidebar-bg: #F5F5F5;
      --illustration-bg: #F0F0F0;

      /* Typography Scale */
      --text-hero: clamp(4rem, 12vw, 14rem);
      --text-display: clamp(2.5rem, 8vw, 8rem);
      --text-stat: clamp(3rem, 10vw, 10rem);
      --text-body: clamp(1rem, 1.5vw, 1.5rem);
      --text-label: clamp(0.7rem, 1vw, 0.9rem);

      /* Spacing */
      --space-xs: 8px;
      --space-sm: 16px;
      --space-md: 24px;
      --space-lg: 40px;
      --space-xl: 60px;
      --space-2xl: 80px;

      /* Easing */
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-in-out-expo: cubic-bezier(0.87, 0, 0.13, 1);

      --font-serif: 'Playfair Display', serif;
      --font-sans: 'Inter', sans-serif;
    }

    body {
      font-family: var(--font-sans);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      min-height: 100dvh;
      overflow: hidden;
    }

    /* ... (keep mobile styles mostly as is, but update colors via variables) ... */

    /* Global Scrollbar Hiding */
    * {
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
      /* IE/Edge */
    }

    *::-webkit-scrollbar {
      display: none;
      /* Chrome/Safari/Opera */
    }

    /* ... (existing mobile styles) ... */

    .app {
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      max-width: 500px;
      margin: 0 auto;
      transition: all 0.3s ease;
    }

    /* Start Screen */
    .start-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px 24px;
      text-align: center;
    }

    .start-screen h1 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .start-screen .subtitle {
      color: var(--text-dim);
      font-size: 1rem;
      margin-bottom: 48px;
    }

    .start-btn {
      background: var(--text);
      color: var(--bg);
      border: none;
      padding: 16px 48px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 30px;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.2s;
    }

    .start-btn:active {
      transform: scale(0.96);
      opacity: 0.9;
    }

    /* Exercise Screen */
    .exercise-screen {
      flex: 1;
      display: none;
      flex-direction: column;
    }

    .exercise-screen.active {
      display: flex;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      flex-shrink: 0;
    }

    .back-btn {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 8px;
      margin: -8px;
      opacity: 0.8;
    }

    .back-btn:disabled {
      opacity: 0.3;
    }

    .header-title {
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 1px;
      color: var(--text-dim);
    }

    .header-timer {
      font-size: 0.95rem;
      font-variant-numeric: tabular-nums;
      color: var(--text-dim);
    }

    /* Main Content Area */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 0 24px 24px;
    }

    /* Exercise Info */
    .exercise-info {
      margin-bottom: 24px;
    }

    .exercise-name {
      font-size: 2.5rem;
      font-weight: 600;
      letter-spacing: -1px;
      margin-bottom: 16px;
      line-height: 1.1;
    }

    /* Progress Dots */
    .progress-dots {
      display: flex;
      gap: 8px;
      margin-bottom: 32px;
    }

    .dot {
      width: 24px;
      height: 6px;
      border-radius: 3px;
      background: var(--text-dim);
      opacity: 0.3;
      transition: all 0.3s ease;
    }

    .dot.active {
      background: var(--accent);
      opacity: 1;
    }

    .dot.completed {
      background: var(--text-dim);
      opacity: 0.6;
    }

    /* Stats Display */
    .stats {
      display: flex;
      gap: 48px;
      margin-bottom: 40px;
    }

    .stat {
      display: flex;
      flex-direction: column;
    }

    .stat-label {
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 1px;
      color: var(--text-dim);
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 3.5rem;
      font-weight: 700;
      letter-spacing: -2px;
      line-height: 1;
    }

    .stat-value.yellow {
      color: var(--accent);
    }

    .stat-value.orange {
      color: var(--accent-orange);
    }

    .stat-value.small {
      font-size: 2rem;
    }

    /* Side Indicator */
    .side-label {
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 0.5px;
      color: var(--accent);
      margin-bottom: 8px;
    }

    /* Exercise Illustration */
    .illustration {
      width: 120px;
      height: 120px;
      margin-bottom: 24px;
      opacity: 0.6;
    }

    .illustration svg {
      width: 100%;
      height: 100%;
    }

    .illustration line,
    .illustration circle,
    .illustration path,
    .illustration ellipse {
      stroke: var(--text);
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
    }

    .illustration .head {
      fill: none;
    }

    @keyframes breathe {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-3px);
      }
    }

    @keyframes nod {

      0%,
      100% {
        transform: translateX(0);
      }

      50% {
        transform: translateX(6px);
      }
    }

    @keyframes tilt {

      0%,
      100% {
        transform: rotate(0deg);
      }

      50% {
        transform: rotate(15deg);
      }
    }

    @keyframes raise {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
      }

      50% {
        transform: translateY(-8px) rotate(-5deg);
      }
    }

    @keyframes tuck {

      0%,
      100% {
        transform: translateX(0);
      }

      50% {
        transform: translateX(-8px);
      }
    }

    @keyframes circle {
      0% {
        transform: rotate(0deg) translateX(0) translateY(0);
      }

      25% {
        transform: rotate(90deg) translateX(0) translateY(-10px);
      }

      50% {
        transform: rotate(180deg) translateX(0) translateY(0);
      }

      75% {
        transform: rotate(270deg) translateX(0) translateY(10px);
      }

      100% {
        transform: rotate(360deg) translateX(0) translateY(0);
      }
    }

    @keyframes slide-up {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-15px);
      }
    }

    @keyframes slide-down {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(15px);
      }
    }

    @keyframes rotate-arms-up {

      0%,
      100% {
        transform: rotate(0deg);
      }

      50% {
        transform: rotate(-45deg);
      }
    }

    @keyframes rotate-arms-down {

      0%,
      100% {
        transform: rotate(0deg);
      }

      50% {
        transform: rotate(45deg);
      }
    }

    @keyframes lift-head {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
      }

      50% {
        transform: translateY(-5px) rotate(-8deg);
      }
    }

    @keyframes step-forward {

      0%,
      100% {
        transform: translateX(0);
      }

      50% {
        transform: translateX(8px);
      }
    }

    @keyframes thread-arm {

      0%,
      100% {
        transform: translateX(0) translateY(0);
      }

      50% {
        transform: translateX(-15px) translateY(10px);
      }
    }

    @keyframes y-position {

      0%,
      100% {
        transform: rotate(0deg) translateY(0);
      }

      50% {
        transform: rotate(-30deg) translateY(-20px);
      }
    }

    @keyframes t-position {

      0%,
      100% {
        transform: rotate(0deg) translateY(0);
      }

      50% {
        transform: rotate(0deg) translateY(-15px);
      }
    }

    @keyframes w-position {

      0%,
      100% {
        transform: rotate(0deg) translateY(0);
      }

      50% {
        transform: rotate(15deg) translateY(-10px);
      }
    }

    .anim-breathe {
      animation: breathe 3s ease-in-out infinite;
    }

    .anim-pulse {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 0.8;
        transform: scale(1);
      }
      50% {
        opacity: 1;
        transform: scale(1.15);
      }
    }

    .anim-nod {
      animation: nod 2s ease-in-out infinite;
    }

    .anim-tilt {
      animation: tilt 3s ease-in-out infinite;
    }

    .anim-raise {
      animation: raise 2.5s ease-in-out infinite;
    }

    .anim-tuck {
      animation: tuck 2s ease-in-out infinite;
    }

    .anim-circle {
      animation: circle 4s ease-in-out infinite;
    }

    .anim-slide-up {
      animation: slide-up 3s ease-in-out infinite;
    }

    .anim-slide-down {
      animation: slide-down 3s ease-in-out infinite;
    }

    .anim-rotate-arms-up {
      animation: rotate-arms-up 3s ease-in-out infinite;
    }

    .anim-rotate-arms-down {
      animation: rotate-arms-down 3s ease-in-out infinite;
    }

    .anim-lift-head {
      animation: lift-head 2s ease-in-out infinite;
    }

    .anim-step-forward {
      animation: step-forward 2s ease-in-out infinite;
    }

    .anim-thread-arm {
      animation: thread-arm 3s ease-in-out infinite;
    }

    .anim-y-position {
      animation: y-position 2s ease-in-out infinite;
    }

    .anim-t-position {
      animation: t-position 2s ease-in-out infinite;
    }

    .anim-w-position {
      animation: w-position 2s ease-in-out infinite;
    }

    /* Instructions */
    .instructions {
      font-size: 0.9rem;
      color: var(--text-dim);
      line-height: 1.5;
      margin-bottom: 32px;
      max-height: 80px;
      overflow: hidden;
    }

    /* Bottom Controls */
    .bottom-controls {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 0 4px;
      flex-shrink: 0;
    }

    .nav-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--text);
      width: 48px;
      height: 48px;
      border-radius: 50%;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .nav-btn:active {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(0.95);
    }

    .nav-btn:disabled {
      opacity: 0.3;
    }

    .done-btn {
      background: rgba(74, 222, 128, 0.15);
      border: none;
      color: var(--success);
      padding: 14px 32px;
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 1px;
      border-radius: 30px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .done-btn:active {
      background: rgba(74, 222, 128, 0.25);
      transform: scale(0.96);
    }

    .done-btn .checkmark {
      font-size: 1.1rem;
    }

    /* Completion Screen */
    .completion-screen {
      flex: 1;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px 24px;
      text-align: center;
    }

    .completion-screen.active {
      display: flex;
    }

    .completion-icon {
      font-size: 4rem;
      margin-bottom: 24px;
    }

    .completion-screen h2 {
      font-size: 1.8rem;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .completion-screen p {
      color: var(--text-dim);
      margin-bottom: 48px;
    }

    .completion-stats {
      display: flex;
      gap: 32px;
      margin-bottom: 48px;
    }

    .completion-stat {
      text-align: center;
    }

    .completion-stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
    }

    .completion-stat-label {
      font-size: 0.75rem;
      color: var(--text-dim);
      letter-spacing: 1px;
    }

    .restart-btn {
      background: transparent;
      border: 1px solid var(--text-dim);
      color: var(--text);
      padding: 14px 32px;
      font-size: 1rem;
      font-weight: 500;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .restart-btn:active {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Sound Toggle */
    .sound-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-dim);
      cursor: pointer;
      z-index: 100;
      padding: 8px 16px;
      border-radius: 20px;
      letter-spacing: 1px;
      transition: all 0.2s;
    }

    .sound-toggle:active {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Desktop Sidebar - Hidden on Mobile */
    .desktop-sidebar {
      display: none;
    }

    /* Footer - Hidden on Mobile */
    .exercise-footer {
      display: none;
    }

    /* Hidden */
    .hidden {
      display: none !important;
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideOut {
      from {
        opacity: 1;
        transform: translateX(0);
      }

      to {
        opacity: 0;
        transform: translateX(-100%);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(100%);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.3s ease;
    }

    .slide-out {
      animation: slideOut 0.3s ease forwards;
    }

    .slide-in {
      animation: slideIn 0.3s ease forwards;
    }

    /* ═══════════════════════════════════════════════════════════════
       PREMIUM DESKTOP DESIGN - Editorial & Minimal
       ═══════════════════════════════════════════════════════════════ */
    @media (min-width: 1024px) {
      :root {
        --bg: #FAFAFA;
        --text: #0A0A0A;
        --text-dim: #525252;
        --text-muted: #A3A3A3;
        --accent: #0A0A0A;
        --accent-warm: #C2410C;
        --success: #059669;
        --sidebar-bg: #F5F5F5;
        --illustration-bg: #E5E5E5;
      }

      body {
        background: var(--bg);
        color: var(--text);
      }

      .app {
        max-width: 100%;
        width: 100vw;
        height: 100vh;
        margin: 0;
        border-radius: 0;
        background: var(--bg);
        overflow: hidden;
        position: relative;
      }

      /* ═══════════════════════════════════════════════════════════════
         START SCREEN - Full Viewport Hero
         ═══════════════════════════════════════════════════════════════ */
      .start-screen {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: var(--space-2xl);
        background: var(--bg);
        position: relative;
        overflow: hidden;
      }

      /* Abstract background shape */
      .start-screen::before {
        content: '';
        position: absolute;
        right: -20%;
        top: 50%;
        transform: translateY(-50%);
        width: 70vw;
        height: 70vw;
        background: radial-gradient(circle, var(--illustration-bg) 0%, transparent 70%);
        opacity: 0.6;
        pointer-events: none;
      }

      .start-screen h1 {
        font-family: var(--font-sans);
        font-size: var(--text-hero);
        line-height: 0.9;
        margin-bottom: var(--space-lg);
        color: var(--text);
        letter-spacing: -0.04em;
        text-align: center;
        font-weight: 800;
        text-transform: uppercase;
        position: relative;
        z-index: 1;
      }

      .start-screen .subtitle {
        font-family: var(--font-sans);
        font-size: 1.1rem;
        margin-bottom: var(--space-2xl);
        font-weight: 400;
        color: var(--text-muted);
        text-align: center;
        letter-spacing: 0.25em;
        text-transform: uppercase;
        position: relative;
        z-index: 1;
      }

      .start-btn {
        font-family: var(--font-sans);
        font-size: 1rem;
        padding: 24px 64px;
        background: var(--text);
        color: var(--bg);
        border: 2px solid var(--text);
        border-radius: 0;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        font-weight: 500;
        cursor: pointer;
        position: relative;
        z-index: 1;
        overflow: hidden;
        transition: all 0.5s var(--ease-out-expo);
      }

      .start-btn::before {
        content: '';
        position: absolute;
        inset: 0;
        background: var(--bg);
        transform: translateY(100%);
        transition: transform 0.5s var(--ease-out-expo);
      }

      .start-btn span {
        position: relative;
        z-index: 1;
      }

      .start-btn:hover {
        color: var(--text);
        transform: translateY(-4px);
      }

      .start-btn:hover::before {
        transform: translateY(0);
      }

      /* ═══════════════════════════════════════════════════════════════
         EXERCISE SCREEN - Asymmetric Magazine Layout
         ═══════════════════════════════════════════════════════════════ */
      .exercise-screen {
        width: 100%;
        height: 100%;
        background: var(--bg);
      }

      .exercise-screen.active {
        display: grid;
        grid-template-rows: auto 1fr auto;
        grid-template-columns: 55% 45%;
      }

      /* Header */
      .header {
        grid-column: 1 / -1;
        grid-row: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-lg) var(--space-xl);
        background: transparent;
        border-bottom: none;
      }

      .back-btn {
        display: none;
      }

      .header-title {
        font-size: 0.85rem;
        font-weight: 500;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--text-muted);
      }

      .header-timer {
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-dim);
        font-variant-numeric: tabular-nums;
        letter-spacing: 0.05em;
      }

      /* Desktop Sidebar - Hidden by default, appears on hover */
      .desktop-sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        width: 320px;
        background: var(--bg);
        border-right: 1px solid var(--illustration-bg);
        padding: 100px var(--space-lg);
        transform: translateX(-290px);
        transition: transform 0.5s var(--ease-out-expo);
        z-index: 100;
        display: flex;
        flex-direction: column;
        gap: 4px;
        overflow-y: auto;
      }

      .desktop-sidebar:hover {
        transform: translateX(0);
      }

      /* Sidebar visual indicator when collapsed */
      .desktop-sidebar::after {
        content: '';
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 60px;
        background: var(--illustration-bg);
        border-radius: 2px;
        transition: background 0.3s ease;
      }

      .desktop-sidebar:hover::after {
        background: transparent;
      }

      .sidebar-item {
        padding: 16px 24px;
        color: var(--text-muted);
        font-size: 0.95rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s var(--ease-out-expo);
        border-radius: 4px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .sidebar-item:hover {
        background: var(--illustration-bg);
        color: var(--text);
      }

      .sidebar-item.active {
        color: var(--text);
        background: var(--illustration-bg);
        font-weight: 600;
      }

      .sidebar-item.completed {
        color: var(--success);
      }

      /* Main Content */
      .main-content {
        grid-column: 1 / -1;
        grid-row: 2;
        display: grid;
        grid-template-columns: 55% 45%;
        padding: 0;
        overflow: hidden;
        height: 100%;
      }

      .exercise-info {
        display: contents;
        margin: 0;
      }

      /* Content wrapper for right side - vertical centering */
      .content-wrapper {
        grid-column: 2;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding-right: var(--space-xl);
      }

      /* Illustration Area (Left) */
      .illustration {
        grid-column: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-xl);
        position: relative;
        width: 100%;
        height: 100%;
        margin: 0;
        opacity: 1;
      }

      .illustration::before {
        content: '';
        position: absolute;
        width: 80%;
        height: 80%;
        background: radial-gradient(circle, var(--illustration-bg) 0%, transparent 70%);
        opacity: 0.5;
        pointer-events: none;
      }

      .illustration svg {
        width: 100%;
        height: 100%;
        max-width: 500px;
        max-height: 500px;
        position: relative;
        z-index: 1;
      }

      .illustration line,
      .illustration circle,
      .illustration path,
      .illustration ellipse {
        stroke: var(--text);
      }

      /* Content Area (Right) */
      .side-label {
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--accent-warm);
        margin: 0;
        margin-bottom: var(--space-sm);
      }

      .exercise-name {
        font-family: var(--font-sans);
        font-size: clamp(2.5rem, 5vw, 5rem);
        font-weight: 800;
        line-height: 0.95;
        letter-spacing: -0.02em;
        color: var(--text);
        margin: 0;
        margin-bottom: var(--space-md);
        text-transform: uppercase;
      }

      .progress-dots {
        display: none;
      }

      .stats {
        display: flex;
        gap: var(--space-xl);
        margin: 0;
        margin-bottom: var(--space-md);
      }

      .stat {
        display: flex;
        flex-direction: column;
      }

      .stat-label {
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--text-muted);
        margin-bottom: var(--space-xs);
      }

      .stat-value {
        font-family: var(--font-sans);
        font-size: clamp(3rem, 6vw, 6rem);
        font-weight: 800;
        line-height: 1;
        letter-spacing: -0.03em;
        color: var(--text);
      }

      .stat-value.yellow {
        color: var(--text);
      }

      .stat-value.orange {
        color: var(--accent-warm);
      }

      .stat-value.small {
        font-size: calc(var(--text-stat) * 0.6);
      }

      .instructions {
        font-size: 1.1rem;
        line-height: 1.5;
        color: var(--text-dim);
        font-weight: 400;
        max-height: none;
        margin: 0;
        margin-bottom: var(--space-lg);
        max-width: 480px;
      }

      .bottom-controls {
        display: flex;
        gap: var(--space-md);
      }

      .nav-btn {
        width: 64px;
        height: 64px;
        font-size: 1.5rem;
        background: transparent;
        border: 2px solid var(--illustration-bg);
        color: var(--text-dim);
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.4s var(--ease-out-expo);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .nav-btn:hover:not(:disabled) {
        background: var(--text);
        color: var(--bg);
        border-color: var(--text);
        transform: scale(1.05);
      }

      .nav-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      .done-btn {
        padding: 0 48px;
        height: 64px;
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        background: var(--text);
        color: var(--bg);
        border: 2px solid var(--text);
        border-radius: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
        overflow: hidden;
        transition: all 0.5s var(--ease-out-expo);
      }

      .done-btn::before {
        content: '';
        position: absolute;
        inset: 0;
        background: var(--success);
        transform: translateX(-100%);
        transition: transform 0.5s var(--ease-out-expo);
      }

      .done-btn span,
      .done-btn .checkmark {
        position: relative;
        z-index: 1;
      }

      .done-btn:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .done-btn:hover::before {
        transform: translateX(0);
      }

      .done-btn:active {
        transform: translateY(-2px) scale(0.98);
      }

      /* Footer with Progress Bar */
      .exercise-footer {
        grid-column: 1 / -1;
        grid-row: 3;
        padding: var(--space-md) var(--space-xl);
        display: flex !important;
        align-items: center;
        gap: var(--space-lg);
        border-top: 1px solid var(--illustration-bg);
      }

      .progress-track {
        flex: 1;
        height: 3px;
        background: var(--illustration-bg);
        border-radius: 2px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: var(--text);
        border-radius: 2px;
        transition: width 0.5s var(--ease-out-expo);
      }

      .progress-text {
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--text-muted);
        letter-spacing: 0.05em;
        white-space: nowrap;
      }

      /* ═══════════════════════════════════════════════════════════════
         COMPLETION SCREEN
         ═══════════════════════════════════════════════════════════════ */
      .completion-screen {
        width: 100%;
        height: 100%;
        padding: var(--space-2xl);
        background: var(--bg);
        position: relative;
        overflow: hidden;
      }

      .completion-screen::before {
        content: '';
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 80vw;
        height: 80vw;
        background: radial-gradient(circle, var(--illustration-bg) 0%, transparent 60%);
        opacity: 0.5;
        pointer-events: none;
      }

      .completion-icon {
        font-size: 6rem;
        margin-bottom: var(--space-lg);
        color: var(--success);
        position: relative;
        z-index: 1;
      }

      .completion-screen h2 {
        font-family: var(--font-sans);
        font-size: clamp(3rem, 8vw, 6rem);
        font-weight: 800;
        letter-spacing: -0.03em;
        text-transform: uppercase;
        margin-bottom: var(--space-md);
        color: var(--text);
        position: relative;
        z-index: 1;
      }

      .completion-screen p {
        font-size: 1.25rem;
        color: var(--text-dim);
        margin-bottom: var(--space-2xl);
        position: relative;
        z-index: 1;
      }

      .completion-stats {
        display: flex;
        gap: var(--space-2xl);
        margin-bottom: var(--space-2xl);
        position: relative;
        z-index: 1;
      }

      .completion-stat {
        text-align: center;
      }

      .completion-stat-value {
        font-family: var(--font-sans);
        font-size: clamp(2.5rem, 6vw, 4rem);
        font-weight: 800;
        color: var(--text);
        letter-spacing: -0.02em;
      }

      .completion-stat-label {
        font-size: 0.8rem;
        font-weight: 600;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--text-muted);
        margin-top: var(--space-xs);
      }

      .restart-btn {
        padding: 20px 56px;
        font-size: 1rem;
        font-weight: 500;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        background: transparent;
        color: var(--text);
        border: 2px solid var(--text);
        border-radius: 0;
        cursor: pointer;
        position: relative;
        z-index: 1;
        overflow: hidden;
        transition: all 0.5s var(--ease-out-expo);
      }

      .restart-btn::before {
        content: '';
        position: absolute;
        inset: 0;
        background: var(--text);
        transform: translateY(100%);
        transition: transform 0.5s var(--ease-out-expo);
      }

      .restart-btn span {
        position: relative;
        z-index: 1;
      }

      .restart-btn:hover {
        color: var(--bg);
        transform: translateY(-4px);
      }

      .restart-btn:hover::before {
        transform: translateY(0);
      }

      /* ═══════════════════════════════════════════════════════════════
         SOUND TOGGLE
         ═══════════════════════════════════════════════════════════════ */
      .sound-toggle {
        position: fixed;
        top: var(--space-lg);
        right: var(--space-xl);
        padding: 0;
        background: transparent;
        border: none;
        font-size: 0.75rem;
        font-weight: 500;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        color: var(--text-muted);
        cursor: pointer;
        transition: color 0.3s var(--ease-out-expo);
        z-index: 50;
      }

      .sound-toggle:hover {
        color: var(--text);
        background: transparent;
        transform: none;
      }

      /* ═══════════════════════════════════════════════════════════════
         ANIMATIONS
         ═══════════════════════════════════════════════════════════════ */
      @keyframes slideInFromRight {
        from {
          opacity: 0;
          transform: translateX(60px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes slideOutToLeft {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(-60px);
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes countdownPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
      }

      /* Staggered entry animations */
      .slide-in .illustration { animation: fadeInUp 0.6s var(--ease-out-expo) 0s both; }
      .slide-in .content-wrapper { animation: fadeInUp 0.6s var(--ease-out-expo) 0.1s both; }

      .slide-out {
        animation: slideOutToLeft 0.5s var(--ease-out-expo) forwards;
      }

      .countdown-warning {
        animation: countdownPulse 0.8s var(--ease-out-expo) infinite;
        color: var(--accent-warm) !important;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <button class="sound-toggle" id="soundToggle">SOUND ON</button>

    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
      <h1>Fix<br>Truong</h1>
      <p class="subtitle">15–20 min · 7 exercises</p>
      <button class="start-btn" id="startBtn"><span>Begin Session</span></button>
    </div>

    <!-- Exercise Screen -->
    <div class="exercise-screen" id="exerciseScreen">
      <div class="desktop-sidebar" id="desktopSidebar"></div>
      <div class="header">
        <button class="back-btn" id="backBtn">‹</button>
        <span class="header-title" id="headerTitle">RELEASE & MOBILIZE</span>
        <span class="header-timer" id="sessionTimer">0:00</span>
      </div>

      <div class="main-content">
        <div class="exercise-info fade-in" id="exerciseInfo">
          <div class="illustration" id="illustration"></div>
          <div class="content-wrapper">
            <div class="side-label hidden" id="sideLabel">LEFT SIDE</div>
            <h1 class="exercise-name" id="exerciseName">Chin Tucks</h1>

            <div class="progress-dots" id="progressDots"></div>

            <div class="stats" id="stats">
              <div class="stat">
                <span class="stat-label">REPS</span>
                <span class="stat-value yellow" id="primaryStat">10</span>
              </div>
              <div class="stat" id="secondaryStat">
                <span class="stat-label">HOLD</span>
                <span class="stat-value orange" id="secondaryValue">5s</span>
              </div>
            </div>

            <p class="instructions" id="instructions">
              Gently draw your chin straight back, creating a "double chin." Hold 5 seconds.
            </p>
            <div class="bottom-controls">
              <button class="nav-btn" id="prevBtn">‹</button>
              <button class="done-btn" id="doneBtn">
                <span>DONE</span> <span class="checkmark">✓</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Progress Footer -->
      <footer class="exercise-footer" id="exerciseFooter">
        <div class="progress-track">
          <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <span class="progress-text" id="progressText">1 of 7</span>
      </footer>
    </div>

    <!-- Completion Screen -->
    <div class="completion-screen" id="completionScreen">
      <div class="completion-icon">✓</div>
      <h2>Well Done</h2>
      <p>Your neck and posture will thank you.</p>
      <div class="completion-stats">
        <div class="completion-stat">
          <div class="completion-stat-value" id="finalTime">15:00</div>
          <div class="completion-stat-label">DURATION</div>
        </div>
        <div class="completion-stat">
          <div class="completion-stat-value" id="finalExercises">7</div>
          <div class="completion-stat-label">EXERCISES</div>
        </div>
      </div>
      <button class="restart-btn" id="restartBtn"><span>Start Again</span></button>
    </div>
  </div>

  <script>
    // Abstract SVG illustrations for each exercise
    const illustrations = {
      chinTucks: `<svg viewBox="0 0 100 100">
        <!-- Abstract: Receding concentric circles suggesting backward movement -->
        <defs>
          <linearGradient id="fade-ct" x1="100%" y1="0%" x2="0%" y2="0%">
            <stop offset="0%" style="stop-color:#0A0A0A;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#0A0A0A;stop-opacity:0.1" />
          </linearGradient>
        </defs>
        <!-- Primary circle -->
        <circle cx="60" cy="50" r="30" fill="none" stroke="#0A0A0A" stroke-width="2.5" class="anim-tuck" style="transform-origin: 60px 50px"/>
        <!-- Receding circles -->
        <circle cx="50" cy="50" r="24" fill="none" stroke="#525252" stroke-width="1.5" opacity="0.6"/>
        <circle cx="42" cy="50" r="18" fill="none" stroke="#A3A3A3" stroke-width="1" opacity="0.4"/>
        <circle cx="36" cy="50" r="12" fill="none" stroke="#E5E5E5" stroke-width="0.75" opacity="0.3"/>
        <!-- Direction line -->
        <line x1="85" y1="50" x2="20" y2="50" stroke="url(#fade-ct)" stroke-width="2" stroke-linecap="round"/>
        <!-- Accent dot -->
        <circle cx="60" cy="50" r="4" fill="#C2410C" class="anim-pulse"/>
      </svg>`,

      neckCircles: `<svg viewBox="0 0 100 100">
        <!-- Abstract: Rotating arc segments -->
        <g class="anim-circle" style="transform-origin: 50px 50px">
          <!-- Arc segments forming a circle -->
          <path d="M50 20 A30 30 0 0 1 80 50" fill="none" stroke="#0A0A0A" stroke-width="3" stroke-linecap="round"/>
          <path d="M80 50 A30 30 0 0 1 50 80" fill="none" stroke="#525252" stroke-width="2.5" stroke-linecap="round"/>
          <path d="M50 80 A30 30 0 0 1 20 50" fill="none" stroke="#A3A3A3" stroke-width="2" stroke-linecap="round"/>
          <path d="M20 50 A30 30 0 0 1 50 20" fill="none" stroke="#E5E5E5" stroke-width="1.5" stroke-linecap="round"/>
        </g>
        <!-- Center point -->
        <circle cx="50" cy="50" r="3" fill="#0A0A0A"/>
        <!-- Outer guide ring -->
        <circle cx="50" cy="50" r="38" fill="none" stroke="#E5E5E5" stroke-width="0.5" stroke-dasharray="4,4"/>
      </svg>`,

      upperTrap: `<svg viewBox="0 0 100 100">
        <!-- Abstract: Tilted oval with pressure point -->
        <g class="anim-tilt" style="transform-origin: 50px 50px">
          <!-- Main oval representing tension area -->
          <ellipse cx="50" cy="45" rx="35" ry="20" fill="none" stroke="#0A0A0A" stroke-width="2" transform="rotate(-15 50 45)"/>
          <!-- Inner tension lines -->
          <path d="M25 50 Q50 35 75 50" fill="none" stroke="#525252" stroke-width="1" opacity="0.5"/>
          <path d="M30 55 Q50 42 70 55" fill="none" stroke="#A3A3A3" stroke-width="0.75" opacity="0.3"/>
        </g>
        <!-- Pressure point -->
        <circle cx="65" cy="35" r="6" fill="#C2410C" opacity="0.8" class="anim-pulse"/>
        <circle cx="65" cy="35" r="10" fill="none" stroke="#C2410C" stroke-width="1" opacity="0.4"/>
        <!-- Direction indicator -->
        <line x1="50" y1="70" x2="65" y2="80" stroke="#0A0A0A" stroke-width="1.5" stroke-linecap="round" opacity="0.5"/>
      </svg>`,

      levatorScap: `<svg viewBox="0 0 100 100">
        <!-- Abstract: Diagonal tension lines -->
        <g class="anim-tilt" style="transform-origin: 50px 50px">
          <!-- Primary diagonal -->
          <line x1="25" y1="75" x2="75" y2="25" stroke="#0A0A0A" stroke-width="3" stroke-linecap="round"/>
          <!-- Parallel tension lines -->
          <line x1="30" y1="80" x2="80" y2="30" stroke="#525252" stroke-width="1.5" stroke-linecap="round" opacity="0.5"/>
          <line x1="20" y1="70" x2="70" y2="20" stroke="#A3A3A3" stroke-width="1" stroke-linecap="round" opacity="0.3"/>
        </g>
        <!-- Pressure point at intersection -->
        <circle cx="60" cy="35" r="6" fill="#C2410C" opacity="0.8" class="anim-pulse"/>
        <!-- Rotation indicator arc -->
        <path d="M70 55 Q85 40 70 25" fill="none" stroke="#0A0A0A" stroke-width="1" opacity="0.4" stroke-dasharray="3,3"/>
      </svg>`,

      doorwayPec: `<svg viewBox="0 0 100 100">
        <!-- Doorway pec stretch: arm against doorframe, stepping through -->
        <!-- Doorframe (vertical) -->
        <line x1="70" y1="10" x2="70" y2="90" stroke="#E5E5E5" stroke-width="6"/>
        <!-- Person's body (vertical torso) -->
        <g class="anim-step-forward">
          <line x1="45" y1="45" x2="45" y2="75" stroke="#0A0A0A" stroke-width="2.5" stroke-linecap="round"/>
          <!-- Head -->
          <circle cx="45" cy="35" r="8" fill="none" stroke="#0A0A0A" stroke-width="2.5"/>
          <!-- Arm at 90° against doorframe -->
          <!-- Upper arm horizontal -->
          <line x1="45" y1="48" x2="70" y2="48" stroke="#0A0A0A" stroke-width="2.5" stroke-linecap="round"/>
          <!-- Forearm vertical (90°) -->
          <line x1="70" y1="48" x2="70" y2="28" stroke="#0A0A0A" stroke-width="2.5" stroke-linecap="round"/>
          <!-- Elbow point -->
          <circle cx="70" cy="48" r="3" fill="#C2410C"/>
          <!-- Legs (stepping forward) -->
          <line x1="45" y1="75" x2="38" y2="90" stroke="#0A0A0A" stroke-width="2" stroke-linecap="round"/>
          <line x1="45" y1="75" x2="55" y2="90" stroke="#0A0A0A" stroke-width="2" stroke-linecap="round"/>
        </g>
        <!-- Step direction arrow -->
        <path d="M30 60 L20 60" stroke="#C2410C" stroke-width="1.5" stroke-linecap="round"/>
        <path d="M23 57 L20 60 L23 63" stroke="#C2410C" stroke-width="1.5" stroke-linecap="round" fill="none"/>
      </svg>`,

      chinTuckNod: `<svg viewBox="0 0 100 100">
        <!-- Abstract: Lying flat with small head lift -->
        <!-- Ground/floor line -->
        <line x1="10" y1="70" x2="90" y2="70" stroke="#E5E5E5" stroke-width="3" stroke-linecap="round"/>
        <!-- Body lying flat (horizontal line) -->
        <line x1="35" y1="65" x2="85" y2="65" stroke="#0A0A0A" stroke-width="2.5" stroke-linecap="round"/>
        <!-- Head with slight lift -->
        <g class="anim-lift-head" style="transform-origin: 25px 65px">
          <circle cx="25" cy="60" r="12" fill="none" stroke="#0A0A0A" stroke-width="2.5"/>
          <!-- Small lift indicator -->
          <line x1="25" y1="70" x2="25" y2="62" stroke="#C2410C" stroke-width="2" stroke-linecap="round"/>
        </g>
        <!-- 1-2cm label area -->
        <text x="25" y="85" font-size="8" fill="#A3A3A3" text-anchor="middle" font-family="Inter, sans-serif">1-2cm</text>
        <!-- Upward arrow indicator -->
        <path d="M10 55 L10 45" stroke="#C2410C" stroke-width="1.5" stroke-linecap="round"/>
        <path d="M7 48 L10 45 L13 48" stroke="#C2410C" stroke-width="1.5" stroke-linecap="round" fill="none"/>
      </svg>`,

      wallAngels: `<svg viewBox="0 0 100 100">
        <!-- Abstract: Vertical lines with sliding horizontal elements -->
        <!-- Background vertical lines (wall) -->
        <line x1="30" y1="15" x2="30" y2="85" stroke="#E5E5E5" stroke-width="1"/>
        <line x1="50" y1="15" x2="50" y2="85" stroke="#E5E5E5" stroke-width="1"/>
        <line x1="70" y1="15" x2="70" y2="85" stroke="#E5E5E5" stroke-width="1"/>
        <!-- Sliding horizontal elements -->
        <g class="anim-slide-up" style="transform-origin: 50px 50px">
          <line x1="20" y1="35" x2="80" y2="35" stroke="#0A0A0A" stroke-width="3" stroke-linecap="round"/>
          <line x1="25" y1="50" x2="75" y2="50" stroke="#525252" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
          <line x1="30" y1="65" x2="70" y2="65" stroke="#A3A3A3" stroke-width="1.5" stroke-linecap="round" opacity="0.3"/>
        </g>
        <!-- Movement indicators -->
        <circle cx="20" cy="35" r="3" fill="#C2410C"/>
        <circle cx="80" cy="35" r="3" fill="#C2410C"/>
        <!-- Arrow indicators -->
        <path d="M15 45 L15 25" stroke="#0A0A0A" stroke-width="1" opacity="0.4"/>
        <path d="M85 45 L85 25" stroke="#0A0A0A" stroke-width="1" opacity="0.4"/>
      </svg>`
    };

    // Exercise data
    const exercises = [
      {
        name: "Chin Tucks",
        part: "RELEASE & MOBILIZE",
        instructions: "Draw your chin straight back, creating a \"double chin.\" Hold 5 seconds.",
        type: "auto-reps",
        reps: 10,
        hold: 5,
        rest: 3,
        sides: 1,
        illustration: "chinTucks"
      },
      {
        name: "Neck Circles",
        part: "RELEASE & MOBILIZE",
        instructions: "Let your head drop forward, slowly roll ear to shoulder, back, other shoulder, forward.",
        type: "reps",
        reps: 5,
        sides: 2,
        sideNames: ["CLOCKWISE", "COUNTER-CLOCKWISE"],
        illustration: "neckCircles"
      },
      {
        name: "Upper Trap Stretch",
        part: "RELEASE & MOBILIZE",
        instructions: "Sit on one hand. Tilt ear toward opposite shoulder, add light pressure with free hand.",
        type: "timed",
        duration: 40,
        sides: 2,
        sideNames: ["LEFT SIDE", "RIGHT SIDE"],
        illustration: "upperTrap"
      },
      {
        name: "Levator Scap Stretch",
        part: "RELEASE & MOBILIZE",
        instructions: "Same position, but rotate nose toward armpit before tilting down.",
        type: "timed",
        duration: 40,
        sides: 2,
        sideNames: ["LEFT SIDE", "RIGHT SIDE"],
        illustration: "levatorScap"
      },
      {
        name: "Doorway Pec Stretch",
        part: "OPEN FRONT BODY",
        instructions: "Forearm against doorframe at 90°. Step through until you feel chest stretch.",
        type: "timed",
        duration: 40,
        sides: 2,
        sideNames: ["LEFT ARM", "RIGHT ARM"],
        illustration: "doorwayPec"
      },

      {
        name: "Chin Tuck + Nod",
        part: "STRENGTHEN",
        instructions: "Lie on back. Tuck chin, lift head 1-2cm off floor. Hold 8 seconds.",
        type: "auto-reps",
        reps: 10,
        hold: 8,
        rest: 2,
        sides: 1,
        illustration: "chinTuckNod"
      },

      {
        name: "Wall Angels",
        part: "STRENGTHEN",
        instructions: "Back against wall, arms in goal post. Slide up and down keeping contact with wall.",
        type: "reps",
        reps: 12,
        sides: 1,
        illustration: "wallAngels"
      },

    ];

    // State
    let currentExercise = 0;
    let currentSide = 0;
    let currentRound = 1;
    let currentRep = 0;
    let timeRemaining = 0;
    let isResting = false;
    let isGettingReady = false;
    let getReadyTime = 5;
    let timerInterval = null;
    let sessionStartTime = null;
    let sessionTimerInterval = null;
    let soundEnabled = true;

    // Audio
    let audioCtx = null;
    function beep(freq = 800, dur = 100) {
      if (!soundEnabled) return;
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur / 1000);
      osc.start();
      osc.stop(audioCtx.currentTime + dur / 1000);
    }

    function completionBeep() {
      beep(600, 80);
      setTimeout(() => beep(800, 80), 100);
      setTimeout(() => beep(1000, 150), 200);
    }

    // DOM
    const $ = id => document.getElementById(id);
    const startScreen = $('startScreen');
    const exerciseScreen = $('exerciseScreen');
    const completionScreen = $('completionScreen');

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    function updateSessionTimer() {
      if (!sessionStartTime) return;
      const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
      $('sessionTimer').textContent = formatTime(elapsed);
    }

    function renderSidebar() {
      const sidebar = $('desktopSidebar');
      if (!sidebar) return;

      sidebar.innerHTML = '';
      exercises.forEach((ex, i) => {
        const item = document.createElement('div');
        item.className = 'sidebar-item';
        if (i < currentExercise) item.classList.add('completed');
        if (i === currentExercise) item.classList.add('active');

        const icon = i < currentExercise ? '✓ ' : (i === currentExercise ? '● ' : '· ');
        item.textContent = icon + ' ' + ex.name;
        sidebar.appendChild(item);
      });
    }

    function renderProgressDots() {
      const container = $('progressDots');
      container.innerHTML = '';

      exercises.forEach((ex, i) => {
        const dot = document.createElement('div');
        dot.className = 'dot';
        if (i < currentExercise) dot.classList.add('completed');
        if (i === currentExercise) dot.classList.add('active');
        container.appendChild(dot);
      });

      renderSidebar();
      updateProgressBar();
    }

    function updateProgressBar() {
      const progressFill = $('progressFill');
      const progressText = $('progressText');
      if (progressFill && progressText) {
        const progress = ((currentExercise + 1) / exercises.length) * 100;
        progressFill.style.width = `${progress}%`;
        progressText.textContent = `${currentExercise + 1} of ${exercises.length}`;
      }
    }

    function showExercise() {
      const ex = exercises[currentExercise];

      $('headerTitle').textContent = ex.part;
      $('exerciseName').textContent = ex.name;
      $('instructions').textContent = ex.instructions;
      $('illustration').innerHTML = illustrations[ex.illustration] || '';

      // Side label
      const sideLabel = $('sideLabel');
      if (ex.sides > 1 && ex.sideNames) {
        const roundText = ex.rounds > 1 ? ` · ROUND ${currentRound}` : '';
        sideLabel.textContent = ex.sideNames[currentSide] + roundText;
        sideLabel.classList.remove('hidden');
      } else {
        sideLabel.classList.add('hidden');
      }

      renderProgressDots();

      $('prevBtn').disabled = currentExercise === 0 && currentSide === 0 && currentRound === 1;
      $('backBtn').disabled = $('prevBtn').disabled;

      // Animate slide-in
      const exerciseInfo = $('exerciseInfo');
      exerciseInfo.classList.remove('fade-in', 'slide-out', 'slide-in');
      void exerciseInfo.offsetWidth; // Force reflow
      exerciseInfo.classList.add('slide-in');

      // Remove slide-in class after animation completes
      setTimeout(() => {
        exerciseInfo.classList.remove('slide-in');
      }, 800);

      // Start get ready countdown
      startGetReadyCountdown();
    }

    function startGetReadyCountdown() {
      if (timerInterval) clearInterval(timerInterval);
      isGettingReady = true;
      timeRemaining = getReadyTime;

      const secondaryStat = $('secondaryStat');

      // Show GET READY state
      $('primaryStat').parentElement.querySelector('.stat-label').textContent = 'GET READY';
      $('primaryStat').textContent = timeRemaining;
      $('primaryStat').className = 'stat-value';
      secondaryStat.classList.add('hidden');
      $('doneBtn').innerHTML = '<span>SKIP</span> <span class="checkmark">→</span>';

      timerInterval = setInterval(() => {
        timeRemaining--;
        $('primaryStat').textContent = timeRemaining;

        if (timeRemaining <= 5 && timeRemaining > 0) {
          $('primaryStat').className = 'stat-value orange countdown-warning';
          beep(500, 60);
        }

        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          isGettingReady = false;
          completionBeep();
          startExerciseTimer();
        }
      }, 1000);
    }

    function startExerciseTimer() {
      const ex = exercises[currentExercise];
      const secondaryStat = $('secondaryStat');

      if (ex.type === 'timed') {
        timeRemaining = ex.duration;
        $('primaryStat').parentElement.querySelector('.stat-label').textContent = 'SECONDS';
        $('primaryStat').textContent = timeRemaining;
        $('primaryStat').className = 'stat-value yellow';
        secondaryStat.classList.add('hidden');
        $('doneBtn').innerHTML = '<span>SKIP</span> <span class="checkmark">→</span>';
        startTimer();
      } else if (ex.type === 'auto-reps') {
        // Auto-reps: show current rep and hold/rest timer
        $('primaryStat').parentElement.querySelector('.stat-label').textContent = 'REP 1 / ' + ex.reps;
        $('primaryStat').textContent = ex.hold;
        $('primaryStat').className = 'stat-value yellow';

        secondaryStat.classList.remove('hidden');
        $('secondaryValue').parentElement.querySelector('.stat-label').textContent = 'STATUS';
        $('secondaryValue').textContent = 'HOLD';
        $('secondaryValue').className = 'stat-value orange';

        $('doneBtn').innerHTML = '<span>SKIP</span> <span class="checkmark">→</span>';
        startAutoRepTimer();
      } else if (ex.type === 'manual') {
        // Manual type: show reps/hold info, single DONE button
        $('primaryStat').parentElement.querySelector('.stat-label').textContent = 'REPS';
        $('primaryStat').textContent = ex.reps;
        $('primaryStat').className = 'stat-value yellow';

        if (ex.hold) {
          secondaryStat.classList.remove('hidden');
          $('secondaryValue').textContent = `${ex.hold}s`;
        } else {
          secondaryStat.classList.add('hidden');
        }
        $('doneBtn').innerHTML = '<span>DONE</span> <span class="checkmark">✓</span>';
      } else {
        // Rep-based exercises: show total reps, allow marking as done
        $('primaryStat').parentElement.querySelector('.stat-label').textContent = 'REPS';
        $('primaryStat').textContent = ex.reps;
        $('primaryStat').className = 'stat-value yellow';

        if (ex.hold) {
          secondaryStat.classList.remove('hidden');
          $('secondaryValue').textContent = `${ex.hold}s`;
        } else {
          secondaryStat.classList.add('hidden');
        }
        $('doneBtn').innerHTML = '<span>DONE</span> <span class="checkmark">✓</span>';
      }
    }

    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeRemaining--;
        $('primaryStat').textContent = timeRemaining;

        if (timeRemaining <= 5 && timeRemaining > 0) {
          $('primaryStat').className = 'stat-value orange countdown-warning';
          beep(500, 60);
        }

        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          completionBeep();
          advanceStep();
        }
      }, 1000);
    }

    function startAutoRepTimer() {
      if (timerInterval) clearInterval(timerInterval);
      const ex = exercises[currentExercise];
      currentRep = 1;
      isResting = false;
      timeRemaining = ex.hold;

      timerInterval = setInterval(() => {
        timeRemaining--;

        // Update Timer UI
        if (isResting) {
          $('primaryStat').textContent = timeRemaining;
          $('primaryStat').className = 'stat-value'; // White/default for rest
        } else {
          $('primaryStat').textContent = timeRemaining;
          $('primaryStat').className = timeRemaining <= 5 ? 'stat-value orange' : 'stat-value yellow';
        }

        // Beep on last 5 seconds of hold
        if (!isResting && timeRemaining <= 5 && timeRemaining > 0) {
          beep(500, 60);
        }

        if (timeRemaining <= 0) {
          if (isResting) {
            // End of Rest -> Start Hold
            isResting = false;
            currentRep++;
            timeRemaining = ex.hold;

            // Update UI for Hold
            $('primaryStat').parentElement.querySelector('.stat-label').textContent = `REP ${currentRep} / ${ex.reps}`;
            $('primaryStat').textContent = timeRemaining;
            $('primaryStat').className = 'stat-value yellow';
            $('secondaryValue').textContent = 'HOLD';
            $('secondaryValue').className = 'stat-value orange';

            beep(800, 150); // Start work beep
          } else {
            // End of Hold
            if (currentRep >= ex.reps) {
              // Finished all reps
              clearInterval(timerInterval);
              completionBeep();
              advanceStep();
            } else {
              // Start Rest
              isResting = true;
              timeRemaining = ex.rest;

              // Update UI for Rest
              $('primaryStat').textContent = timeRemaining;
              $('primaryStat').className = 'stat-value';
              $('secondaryValue').textContent = 'REST';
              $('secondaryValue').className = 'stat-value'; // White/default

              beep(600, 100); // Rest beep
            }
          }
        }
      }, 1000);
    }

    function advanceStep() {
      const ex = exercises[currentExercise];
      const maxRounds = ex.rounds || 1;

      if (currentSide < ex.sides - 1) {
        currentSide++;
        showExercise();
      } else if (currentRound < maxRounds) {
        currentRound++;
        currentSide = 0;
        showExercise();
      } else {
        goNext();
      }
    }

    function handleDone() {
      const ex = exercises[currentExercise];

      // Clear timer immediately
      if (ex.type === 'timed' || ex.type === 'auto-reps') {
        clearInterval(timerInterval);
      } else {
        completionBeep();
      }

      // Advance immediately - animations happen during showExercise
      advanceStep();
    }

    function goNext() {
      if (timerInterval) clearInterval(timerInterval);

      if (currentExercise < exercises.length - 1) {
        currentExercise++;
        currentSide = 0;
        currentRound = 1;
        showExercise();
      } else {
        showCompletion();
      }
    }

    function goPrev() {
      if (timerInterval) clearInterval(timerInterval);

      const ex = exercises[currentExercise];
      const maxRounds = ex.rounds || 1;

      if (currentSide > 0) {
        currentSide--;
      } else if (currentRound > 1) {
        currentRound--;
        currentSide = ex.sides - 1;
      } else if (currentExercise > 0) {
        currentExercise--;
        const prev = exercises[currentExercise];
        currentRound = prev.rounds || 1;
        currentSide = prev.sides - 1;
      }
      showExercise();
    }

    function showCompletion() {
      if (timerInterval) clearInterval(timerInterval);
      if (sessionTimerInterval) clearInterval(sessionTimerInterval);

      const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
      $('finalTime').textContent = formatTime(elapsed);
      $('finalExercises').textContent = exercises.length;

      exerciseScreen.classList.remove('active');
      completionScreen.classList.add('active');
      completionBeep();
    }

    function startSession() {
      currentExercise = 0;
      currentSide = 0;
      currentRound = 1;
      sessionStartTime = Date.now();

      startScreen.style.display = 'none';
      completionScreen.classList.remove('active');
      exerciseScreen.classList.add('active');

      sessionTimerInterval = setInterval(updateSessionTimer, 1000);
      showExercise();
    }

    // Events
    $('startBtn').addEventListener('click', startSession);
    $('restartBtn').addEventListener('click', startSession);
    $('doneBtn').addEventListener('click', handleDone);
    $('prevBtn').addEventListener('click', goPrev);
    $('backBtn').addEventListener('click', goPrev);
    $('soundToggle').addEventListener('click', () => {
      soundEnabled = !soundEnabled;
      $('soundToggle').textContent = soundEnabled ? 'SOUND ON' : 'SOUND OFF';
      $('soundToggle').style.opacity = soundEnabled ? '1' : '0.5';
    });

    // Keyboard
    document.addEventListener('keydown', e => {
      if (startScreen.style.display !== 'none' && !exerciseScreen.classList.contains('active')) {
        if (e.code === 'Space' || e.code === 'Enter') {
          e.preventDefault();
          startSession();
        }
        return;
      }

      if (!exerciseScreen.classList.contains('active')) return;

      switch (e.code) {
        case 'Space':
        case 'Enter':
          e.preventDefault();
          handleDone();
          break;
        case 'ArrowRight':
          e.preventDefault();
          goNext();
          break;
        case 'ArrowLeft':
          e.preventDefault();
          goPrev();
          break;
      }
    });
  </script>
</body>

</html>